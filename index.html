<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To‑Do List</title>
  <style>
    :root {
      --bg: #0f172a; /* slate-900 */
      --card: #111827; /* gray-900 */
      --muted: #94a3b8; /* slate-400 */
      --text: #e5e7eb; /* gray-200 */
      --accent: #22d3ee; /* cyan-400 */
      --accent-2: #a78bfa; /* violet-400 */
      --danger: #ef4444; /* red-500 */
      --ok: #10b981; /* emerald-500 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 80% -10%, rgba(167,139,250,.15), transparent 60%),
                  radial-gradient(1000px 700px at -10% 20%, rgba(34,211,238,.12), transparent 60%),
                  var(--bg);
      color: var(--text);
      display: grid; place-items: center;
      padding: 24px;
    }

    .app {
      width: 100%; max-width: 720px; background: linear-gradient(180deg, rgba(255,255,255,.02), transparent), var(--card);
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 24px;
    }

    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 12px; }
    h1 { font-size: 28px; margin: 0; letter-spacing: .5px; }
    .badge { font-size: 12px; color: var(--bg); background: linear-gradient(135deg, var(--accent), var(--accent-2)); padding: 4px 10px; border-radius: 999px; font-weight: 700; }

    .row { display: flex; gap: 10px; width: 100%; }

    #todo-form { display: flex; gap: 8px; margin: 12px 0 16px; }
    #new-task {
      flex: 1; padding: 12px 14px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04);
      outline: none; color: var(--text);
    }
    #new-task::placeholder { color: var(--muted); }
    .btn {
      padding: 10px 14px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06);
      border-radius: 10px; color: var(--text); cursor: pointer; font-weight: 600;
      transition: transform .06s ease, background .2s ease, border-color .2s ease, opacity .2s ease;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #0b1020; border: none; }
    .btn-danger { background: rgba(239,68,68,.1); border-color: rgba(239,68,68,.5); }
    .btn-ghost { background: transparent; }

    .controls { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; }
    .filters { display: flex; gap: 8px; }
    .chip { padding: 8px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,.12); cursor: pointer; user-select: none; }
    .chip[aria-pressed="true"] { background: rgba(167,139,250,.15); border-color: var(--accent-2); }

    #search { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color: var(--text); }

    ul#todo-list { list-style: none; padding: 0; margin: 16px 0; display: grid; gap: 8px; }
    .todo {
      display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 10px; padding: 12px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,.08); background: rgba(255,255,255,.03);
    }
    .todo.completed { opacity: .7; }
    .todo .title { outline: none; word-break: break-word; }
    .todo.completed .title { text-decoration: line-through; }

    .todo .actions { display: flex; gap: 6px; align-items: center; }

    .summary { display: flex; justify-content: space-between; align-items: center; font-size: 14px; color: var(--muted); margin-top: 8px; }

    input[type="checkbox"] { width: 18px; height: 18px; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

    @media (max-width: 540px) {
      .controls { grid-template-columns: 1fr; }
      .summary { flex-direction: column; gap: 8px; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <main class="app" role="application" aria-label="To‑Do List">
    <header>
      <h1>To‑Do List</h1>
      <span class="badge" id="today"></span>
    </header>

    <form id="todo-form" autocomplete="off">
      <label class="sr-only" for="new-task">Add a task</label>
      <input id="new-task" name="task" type="text" placeholder="Add a new task and press Enter…" required minlength="1" />
      <button type="submit" class="btn btn-primary">Add</button>
    </form>

    <section class="controls" aria-label="Controls">
      <input id="search" type="search" placeholder="Search tasks" aria-label="Search tasks" />

      <div class="row" style="justify-content:flex-end; align-items:center;">
        <div class="filters" role="group" aria-label="Filter tasks">
          <button class="chip" data-filter="all" aria-pressed="true">All</button>
          <button class="chip" data-filter="active" aria-pressed="false">Active</button>
          <button class="chip" data-filter="completed" aria-pressed="false">Completed</button>
        </div>
        <button id="clear-completed" class="btn btn-danger" title="Remove all completed tasks">Clear Completed</button>
      </div>
    </section>

    <ul id="todo-list" aria-live="polite"></ul>

    <footer class="summary">
      <div><strong id="items-left">0</strong> item(s) left</div>
      <div>Tip: Double‑click a task to edit • Press <kbd>Enter</kbd> to save</div>
    </footer>
  </main>

  <template id="todo-item-template">
    <li class="todo" draggable="true">
      <input type="checkbox" aria-label="Toggle complete" />
      <div class="title" contenteditable="true" role="textbox" aria-multiline="false"></div>
      <div class="actions">
        <button class="btn btn-ghost" data-action="edit" title="Edit (double‑click the text)">Edit</button>
        <button class="btn btn-ghost" data-action="delete" title="Delete">Delete</button>
      </div>
    </li>
  </template>

  <script>
    (function(){
      const $ = (sel, root=document) => root.querySelector(sel);
      const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

      const STORAGE_KEY = 'todo-list-v1';
      let todos = load();
      let filter = 'all';
      let searchTerm = '';

      // --- Utilities ---
      function uid(){ return Math.random().toString(36).slice(2, 9) + Date.now().toString(36).slice(-3); }
      function load(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { return []; } }
      function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)); }

      function formatToday(){
        const d = new Date();
        const opts = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
        return d.toLocaleDateString(undefined, opts);
      }

      // --- Render ---
      const listEl = $('#todo-list');
      const template = $('#todo-item-template');
      const itemsLeftEl = $('#items-left');

      function render(){
        listEl.innerHTML = '';
        const frag = document.createDocumentFragment();

        let data = todos
          .filter(t => filter === 'all' || (filter === 'active' ? !t.completed : t.completed))
          .filter(t => t.text.toLowerCase().includes(searchTerm));

        data.forEach(t => {
          const node = template.content.firstElementChild.cloneNode(true);
          node.dataset.id = t.id;
          node.classList.toggle('completed', t.completed);
          const checkbox = node.querySelector('input[type="checkbox"]');
          const title = node.querySelector('.title');

          checkbox.checked = t.completed;
          title.textContent = t.text;
          title.setAttribute('aria-label', `Task: ${t.text}`);

          frag.appendChild(node);
        });

        listEl.appendChild(frag);
        itemsLeftEl.textContent = todos.filter(t => !t.completed).length;
      }

      // --- CRUD ---
      function addTask(text){
        todos.unshift({ id: uid(), text: text.trim(), completed: false, createdAt: Date.now() });
        save();
        render();
      }
      function updateTask(id, patch){
        const idx = todos.findIndex(t => t.id === id);
        if (idx !== -1){ todos[idx] = { ...todos[idx], ...patch }; save(); render(); }
      }
      function deleteTask(id){
        todos = todos.filter(t => t.id !== id); save(); render();
      }

      // --- Reorder via Drag & Drop ---
      let dragId = null;
      listEl.addEventListener('dragstart', (e)=>{
        const li = e.target.closest('.todo'); if(!li) return;
        dragId = li.dataset.id;
        e.dataTransfer.setData('text/plain', dragId);
        e.dataTransfer.effectAllowed = 'move';
      });
      listEl.addEventListener('dragover', (e)=>{ e.preventDefault(); const over = e.target.closest('.todo'); if(!over) return; });
      listEl.addEventListener('drop', (e)=>{
        e.preventDefault();
        const target = e.target.closest('.todo'); if(!target) return;
        const targetId = target.dataset.id;
        if (dragId && targetId && dragId !== targetId){
          const from = todos.findIndex(t => t.id === dragId);
          const to = todos.findIndex(t => t.id === targetId);
          const [moved] = todos.splice(from, 1);
          todos.splice(to, 0, moved);
          save(); render();
        }
        dragId = null;
      });

      // --- Events ---
      $('#todo-form').addEventListener('submit', (e)=>{
        e.preventDefault();
        const input = $('#new-task');
        const text = input.value.trim();
        if(!text) return;
        addTask(text);
        input.value = '';
        input.focus();
      });

      listEl.addEventListener('click', (e)=>{
        const li = e.target.closest('.todo');
        if(!li) return;
        const id = li.dataset.id;
        if (e.target.matches('input[type="checkbox"]')){
          updateTask(id, { completed: e.target.checked });
        } else if (e.target.dataset.action === 'delete'){
          deleteTask(id);
        } else if (e.target.dataset.action === 'edit'){
          const title = li.querySelector('.title');
          title.focus();
          selectAllText(title);
        }
      });

      // In-place edit: save on Enter/blur, cancel with Esc
      listEl.addEventListener('keydown', (e)=>{
        const title = e.target.closest('.title');
        if(!title) return;
        const li = title.closest('.todo');
        if (e.key === 'Enter') { e.preventDefault(); title.blur(); }
        if (e.key === 'Escape') { e.preventDefault(); title.textContent = getTask(li.dataset.id).text; title.blur(); }
      });
      listEl.addEventListener('blur', (e)=>{
        const title = e.target.closest('.title');
        if(!title) return;
        const li = title.closest('.todo');
        const newText = title.textContent.trim();
        const id = li.dataset.id;
        if (newText) updateTask(id, { text: newText }); else { title.textContent = getTask(id).text; }
      }, true);

      function getTask(id){ return todos.find(t => t.id === id) || { text: '' }; }
      function selectAllText(el){ const range = document.createRange(); range.selectNodeContents(el); const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range); }

      // Filter chips
      $$('.chip').forEach(btn => btn.addEventListener('click', ()=>{
        $$('.chip').forEach(b => b.setAttribute('aria-pressed', 'false'));
        btn.setAttribute('aria-pressed', 'true');
        filter = btn.dataset.filter;
        render();
      }));

      // Search
      $('#search').addEventListener('input', (e)=>{ searchTerm = e.target.value.trim().toLowerCase(); render(); });

      // Clear completed
      $('#clear-completed').addEventListener('click', ()=>{
        const count = todos.filter(t => t.completed).length;
        if (count === 0) return;
        if (confirm(`Remove ${count} completed task(s)?`)){
          todos = todos.filter(t => !t.completed); save(); render();
        }
      });

      // Initial state
      $('#today').textContent = formatToday();
      render();

      // Seed example on first visit
      if (todos.length === 0) {
        addTask('Welcome! Add your first task.');
        addTask('Double‑click a task to edit.');
        addTask('Drag tasks to reorder.');
        todos.forEach(t => t.completed = t.text.startsWith('Double'));
        save(); render();
      }
    })();
  </script>
</body>
</html>
